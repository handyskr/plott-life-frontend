---
import dayjs from 'dayjs';
import Layout from '@layouts/Layout.astro';
import Header from '@components/template/Header.astro';
import { Calendar, LocationSelect, Modal, ModalHeader, ModalContent, ModalFooter } from '@components/common';
import RoomList from '@components/search/RoomList';
import { Filters } from '@components/search';

import { getWeeksBetween } from '@plott-life/utils';
import IconArrowBigLeft from '@plott-life/ui/icons/arrow-big-left.svg';
import { EXPOSE_DATE_FORMAT } from '../../libs/values';
import { getSearchParams } from '../../libs/utils';

const searchParams = Astro.url.searchParams;

const { stateOrCity, startAt, endAt } = getSearchParams(searchParams, {
  stateOrCity: '전체',
  startAt: dayjs().format('YYYY-MM-DD'),
  endAt: dayjs().add(1, 'week').format('YYYY-MM-DD'),
});

const weeks = getWeeksBetween(startAt, endAt);

const queryString = searchParams.toString();
---

<Layout>
  <Header slot='header'>
    <div class='flex flex-col w-full px-6 py-4 shadow-[0_6px_12px_0_rgba(0,0,0,0.05)]'>
      <div class='flex items-center'>
        <a
          href={`/search${queryString ? `?${queryString}` : ''}`}
          class='flex items-center space-x-2 w-full px-6 h-14 border-[1px] rounded-[28px] border-gray-200 shadow-[0_0_20px_0_rgba(0,0,0,0.08)] hover:shadow-[0_0_20px_0_rgba(0,0,0,0.1)] cursor-pointer'
        >
          <div class='pr-6 m-0'>
            <IconArrowBigLeft />
          </div>
          <div class='flex flex-col'>
            <span class='body4 text-gray-900 mb-0.5'>
              {stateOrCity}
            </span>
            <span class='caption1 text-gray-700'>
              {weeks}주 · {dayjs(startAt).format(EXPOSE_DATE_FORMAT)} ~ {dayjs(endAt).format(EXPOSE_DATE_FORMAT)}
            </span>
          </div>
        </a>
      </div>
      <div class='flex items-center pt-6 gap-3'>
        <Filters
          client:only='preact'
        />
      </div>
    </div>
  </Header>
  <div class='bg-white p-6'>
    <RoomList
      client:only='preact'
      initialRooms={[]}
    />
  </div>
  <footer
    slot='footer'
    class='flex flex-col items-center w-full bg-gray-50 p-8'
  >
    <span class='body2 text-gray-900'>
      찾고있는 방이 없나요?
    </span>
    <span class='body6 text-gray-600 mt-2 mb-4'>
      상담을 통해 조건에 맞는 방을 찾아드립니다.
    </span>
    <button
      id='btn-inquiry'
      class='w-[148px] btn btn-primary body2'
    >
      문의하기
    </button>
  </footer>
</Layout>
