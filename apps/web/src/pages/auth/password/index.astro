---
import Layout from '@layouts/Layout.astro';
import Header from '@components/template/Header.astro';
import { PasswordUpdateForm } from '../_components/PasswordUpdateForm';
import { PasswordResetForm } from '../_components/PasswordResetForm';
import { withQuery } from "ufo";

const searchParams = Astro.url?.searchParams;
const email = searchParams?.get('email');
const token = searchParams?.get('token');

let isUpdate = false;
if (Astro.locals.isLoggedIn) {
  isUpdate = true;
} else if (email && token) {
  isUpdate = false;
} else {
  return Astro.redirect('/auth/login');
}
const subtitle = isUpdate ? "비밀번호 변경" : '비밀번호 설정하기'
---
<Layout subtitle={subtitle}>
  <Header
    slot='header'
    title={subtitle}
    showBackIcon={true}
    showHomeIcon={true}
  />
  <div class='flex flex-col max-w-2xl mx-auto items-center py-4 px-6 md:px-24 md:py-32 lg:py-64'>
    {isUpdate ? (
      <PasswordUpdateForm
        client:load
        successURL={withQuery('/auth/logout', {
          redirectURL: '/auth/password/success',
        })} />
    ) : (
      <PasswordResetForm
        client:load
        email={email!!}
        token={token!!}
        successURL='/auth/password/success'
      />
    )}

  </div>
</Layout>
